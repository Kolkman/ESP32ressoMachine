function HSVtoRGB(e,r,t){var o,a,i,n,c,l,d,u;switch(1===arguments.length&&(r=e.s,t=e.v,e=e.h),l=t*(1-r),d=t*(1-(c=6*e-(n=Math.floor(6*e)))*r),u=t*(1-(1-c)*r),n%6){case 0:o=t,a=u,i=l;break;case 1:o=d,a=t,i=l;break;case 2:o=l,a=t,i=u;break;case 3:o=l,a=d,i=t;break;case 4:o=u,a=l,i=t;break;case 5:o=t,a=l,i=d;break}return{r:Math.round(255*o),g:Math.round(255*a),b:Math.round(255*i)}}var temperatureGauge=new RadialGauge({renderTo:document.createElement("canvas"),width:300,height:300,units:"Â° C ",title:"Temperature",minValue:80,maxValue:120,majorTicks:[80,85,90,95,100,105,110,115,120],minorTicks:2,strokeTicks:!0,highlights:[{from:80,to:100,color:"rgba(0,0, 255, .3)"},{from:100,to:120,color:"rgba(255, 0, 0, .3)"}],ticksAngle:225,startAngle:67.5,colorMajorTicks:"#ddd",colorMinorTicks:"#ddd",colorTitle:"#eee",colorUnits:"#ccc",colorNumbers:"#eee",colorPlate:"#222",borderShadowWidth:0,borders:!0,needleType:"arrow",needleWidth:2,needleCircleSize:7,needleCircleOuter:!0,needleCircleInner:!1,animationDuration:100,animationRule:"linear",colorBorderOuter:"#333",colorBorderOuterEnd:"#111",colorBorderMiddle:"#222",colorBorderMiddleEnd:"#111",colorBorderInner:"#111",colorBorderInnerEnd:"#333",colorNeedleShadowDown:"#333",colorNeedleCircleOuter:"#333",colorNeedleCircleOuterEnd:"#111",colorNeedleCircleInner:"#111",colorNeedleCircleInnerEnd:"#222",valueBoxBorderRadius:0,colorValueBoxRect:"#222",colorValueBoxRectEnd:"#333"}),powerGauge=new LinearGauge({renderTo:document.createElement("canvas"),title:"Heater Power",width:400,height:80,minValue:0,maxValue:3,majorTicks:["0","10","100","1000"],minorTicks:.1,colorPlate:"#8881",borderShadowWidth:0,borders:!1,barBeginCircle:!1,ticksWidth:20,ticksWidthMinor:15,colorNeedle:"cornsilk",colorNumbers:"cornsilk",colorTitle:"cornsilk",animationDuration:150,animationRule:"linear",animationTarget:"plate",tickSide:"left",numberSide:"left",needleSide:"left",needleWidth:7,colorBarProgress:"#327ac0",colorBar:"#f5f5f5"});if(fetch("api/v1/firmware").then((function(e){return e.json()})).then((function(e){parseFirmware(e)})).catch((function(e){})),window.EventSource){var source=new EventSource("/events");source.addEventListener("open",(function(e){}),!1),source.addEventListener("error",(function(e){e.target.readyState,EventSource.OPEN}),!1),source.addEventListener("status",(function(e){parseState(JSON.parse(e.data))}),!1)}function buildStatusLine(e,r,t){divStatusLine=document.createElement("div");var o=document.createElement("div"),a=document.createElement("div");return divStatusLine.setAttribute("class","statusLine"),o.setAttribute("class","measure"),a.setAttribute("class","value"),divStatusLine.setAttribute("id",e),o.setAttribute("id",e),a.setAttribute("id",e),o.innerHTML=t,divStatusLine.appendChild(o),a.innerHTML=r,divStatusLine.appendChild(a),divStatusLine}function parseState(e){temperatureGauge.value=e.measuredTemperature;var r={},t={};r.highlights=[],t.from=80,t.to=e.targetTemperature-5,t.color="rgba(0,0,255,1)",r.highlights.push(t),(t={}).from=e.targetTemperature-5,t.to=e.targetTemperature-2,t.color="rgba(0, 0 , 255, .5)",r.highlights.push(t),(t={}).from=e.targetTemperature-2,t.to=e.targetTemperature-1,t.color="rgba(0, 0 , 255, .25)",r.highlights.push(t),(t={}).from=e.targetTemperature-1,t.to=e.targetTemperature+1,t.color="rgba(0, 255 , 0, 1)",r.highlights.push(t),(t={}).from=e.targetTemperature+1,t.to=e.targetTemperature+2,t.color="rgba(255, 0 , 0, .25)",r.highlights.push(t),(t={}).from=e.targetTemperature+2,t.to=e.targetTemperature+5,t.color="rgba(255, 0, 0, 0.5)",r.highlights.push(t),(t={}).from=e.targetTemperature+5,t.to=120,t.color="rgba(255, 0, 0, 1)",r.highlights.push(t),temperatureGauge.update(r),temperatureGauge.draw(),powerGauge.value=Math.log10(e.heaterPower);var o=HSVtoRGB(.75-.25*Math.log10(Math.max(e.heaterPower,1)),1,1),a={};a.colorBarProgress="rgba("+o.r+","+o.g+","+o.b+",1)",powerGauge.update(a),powerGauge.draw();var i=document.getElementById("toggle--pwr"),n=document.getElementById("toggle--pidext");e.powerOffMode?i.checked=!1:i.checked=!0,e.externalControlMode?n.checked=!1:n.checked=!0}function parseFirmware(e){document.getElementById("firmware").innerHTML="Firmware:"+e.version}function pwrSwitch(){document.getElementById("toggle--pwr").checked?fetch("/api/v1/set?powerOffMode=false"):fetch("/api/v1/set?powerOffMode=true")}function pidextSwitch(){document.getElementById("toggle--pidext").checked?fetch("/api/v1/set?externalControlMode=false"):fetch("/api/v1/set?externalControlMode=true")}