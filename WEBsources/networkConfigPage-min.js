function UpdateScanTable(){fetch(url+"scan").then((function(e){return e.json()})).then((function(e){let t=[];e.sort((function(e,t){e.rssi,t.rssi}));let s=[];e.forEach((e=>{s.includes(e.ssid)||(s.push(e.ssid),t.push(e))}));const i=document.getElementById("scantable");for(;i.hasChildNodes();)i.removeChild(i.firstChild);for(var n=0;n<t.length;n++)i.append(createScanRow(t[n],n))})).catch((function(e){}))}function createScanRow(e,t){let s=document.createElement("div");s.setAttribute("id","networkRow"+t),s.setAttribute("class","networkSelection tableRow");let i=document.createElement("div");i.setAttribute("id","SSID"+t),i.setAttribute("class","SSIDField tableField");let n=document.createElement("a");n.setAttribute("href","#p"),n.setAttribute("onClick",'c(this,"'+e.pass+'")'),n.innerHTML=e.ssid,i.appendChild(n),s.append(i);let l,a=document.createElement("div");switch(a.setAttribute("id","securityVal"+t),a.setAttribute("class","SecurityField tableField"),e.secure){case 0:l="open";break;case 1:l="WEP";break;case 2:l="WPA_PSK";break;case 3:l="WPA2_PSK";break;case 4:l="WPA_WPA2_PSK";break;case 5:l="WPA2_ENTERPRISE";break;case 6:l="WPA3_PSK";break;case 7:l="WPA2_WPA3_PSK";break;case 8:l="WAPI_PSK";break;default:l="unknown"}a.innerHTML=l,s.append(a),wifiSymbol=document.createElement("div"),wifiSymbol.setAttribute("id","wifiSym"+t),wifiSymbol.setAttribute("class","wifiSymbol tableField");const r=rssiQuality(e.rssi);return wifiSymbol.setAttribute("title","Signal: "+r+"% (rssi: "+e.rssi+")"),signalstr=document.createElement("div"),r>90?signalstr.setAttribute("class","waveStrength waveStrength-4"):r>70?signalstr.setAttribute("class","waveStrength waveStrength-3"):r>40?signalstr.setAttribute("class","waveStrength waveStrength-2"):r>10?signalstr.setAttribute("class","waveStrength waveStrength-1"):signalstr.setAttribute("class","waveStrength waveStrength-0"),w0=document.createElement("div"),w0.setAttribute("class","wv0 wave"),w0.setAttribute("style","color:transparent"),w1=document.createElement("div"),w1.setAttribute("class","wv1 wave"),w1.appendChild(w0),w2=document.createElement("div"),w2.setAttribute("class","wv2 wave"),w2.setAttribute("style",""),w2.appendChild(w1),w3=document.createElement("div"),w3.setAttribute("class","wv3 wave"),w3.setAttribute("style",""),w3.appendChild(w2),w4=document.createElement("div"),w4.setAttribute("class","wv4 wave"),w4.setAttribute("style",""),w4.appendChild(w3),signalstr.appendChild(w4),wifiSymbol.appendChild(signalstr),s.append(wifiSymbol),s}function rssiQuality(e){let t=0;return t=e<=-100?0:e>=-50?100:2*(e+100),t}function c(e,t){let s=document.getElementsByClassName("wrapperblock").length;for(let i=0;i<s;i++)if(""==document.getElementById("s"+i).value){document.getElementById("s"+i).value=e.innerText||e.textContent,document.getElementById("p"+i).value=t,document.getElementById("p"+i).focus();break}}function resetSSID(e){document.getElementById("s"+e).value="",document.getElementById("p"+e).value=""}function updatePage(){let e;fetch(url+"configConfig").then((function(e){return e.json()})).then((function(t){if(e=t.maxNets,t.mqtt)mqttHost=document.getElementById("mqttHost"),mqttHost.setAttribute("value",t.mqttHost),mqttUser=document.getElementById("mqttUser"),mqttUser.setAttribute("value",t.mqttUser),mqttPass=document.getElementById("mqttPass"),mqttPass.setAttribute("value",t.mqttPass);else{const e=document.getElementById("MQTTSettings");for(;e.hasChildNodes();)e.removeChild(e.firstChild)}selecteNetworks=document.getElementById("selectedNetworks");for(let e=0;e<t.maxNets;e++)wrapper=document.createElement("fieldset"),wrapper.setAttribute("id","wrapper"+e),wrapper.setAttribute("class","wrapperblock"),ssidline=document.createElement("div"),ssidline.setAttribute("class","entryline"),ssidfield=document.createElement("div"),ssidfield.setAttribute("class","nettableLabel"),ls=document.createElement("label"),ls.innerHTML="SSID",ssidfield.appendChild(ls),ssidline.appendChild(ssidfield),ip=document.createElement("input"),ip.setAttribute("id","s"+e),ip.setAttribute("name","s"+e),ip.setAttribute("placeholder","SSID"+e),ssidline.appendChild(ip),redcross=document.createElement("div"),redcross.setAttribute("class","redCross"),crossimg=document.createElement("img"),crossimg.setAttribute("width","20px"),crossimg.setAttribute("onClick","resetSSID("+e+")"),crossimg.setAttribute("src","redCircleCrossed.svg"),ssidline.appendChild(crossimg),wrapper.append(ssidline),passline=document.createElement("div"),passline.setAttribute("class","entryline"),passfield=document.createElement("div"),passfield.setAttribute("class","nettableLabel"),lp=document.createElement("label"),lp.innerHTML="Passwd",passfield.appendChild(lp),passline.appendChild(passfield),ip=document.createElement("input"),ip.setAttribute("id","p"+e),ip.setAttribute("name","p"+e),ip.setAttribute("placeholder","Password"+e),passline.appendChild(ip),wrapper.append(passline),selecteNetworks.appendChild(wrapper)})).catch((function(e){}))}window.addEventListener("load",(function(){updatePage(),UpdateScanTable()}));